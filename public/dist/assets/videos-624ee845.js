import{_ as me}from"./index-7ca7aa2a.js";const a=window.Vue.createElementVNode,r=window.Vue.unref,o=window.Vue.createVNode,v=window.Vue.resolveComponent,n=window.Vue.withCtx,fe=window.Vue.withKeys,j=window.Vue.renderList,A=window.Vue.Fragment,s=window.Vue.openBlock,_=window.Vue.createElementBlock,z=window.Vue.createBlock,u=window.Vue.createTextVNode,w=window.Vue.toDisplayString,W=window.Vue.createCommentVNode,we=window.Vue.resolveDirective,ge=window.Vue.withDirectives,ye={class:"video-admin-container"},Ve={class:"header-bar"},be={class:"filter-section"},he={class:"filter-bar"},ke={class:"filter-item"},Ce={class:"stats-bar"},Ee={class:"stat-item"},xe={class:"stat-value"},$e={class:"stat-item"},Ie={class:"stat-value"},De={key:0,class:"table-section"},Pe=["onClick"],Se={key:0,class:"thumb-loading"},ze=["src"],Fe=["src"],Me={key:3,class:"thumb-placeholder"},Re={class:"thumb-overlay"},Ue={class:"title-cell"},Ne=["title"],Le=["title"],Be={class:"time-cell"},Te={class:"action-buttons"},Ke={key:1,class:"empty-state"},qe={class:"empty-content"},We={class:"empty-desc"},Ze={class:"empty-actions"},He={class:"dialog-footer"},Oe={class:"delete-content"},Ye={class:"delete-text"},je={class:"dialog-footer"},Ae={class:"preview-content"},Ge=["src"],Je=["src"],i=window.Vue.ref,Qe=window.Vue.onMounted;window.Vue.computed;const Xe=window.VueRouter.useRouter,F=window.axios,m=window.ElementPlus.ElMessage;window.ElementPlus.ElMessageBox;const G=window.ElementPlusIconsVue.UploadFilled,et=window.ElementPlusIconsVue.Edit,tt=window.ElementPlusIconsVue.Delete,lt=window.ElementPlusIconsVue.View,ot=window.ElementPlusIconsVue.Search,Z=window.ElementPlusIconsVue.Refresh,nt=window.ElementPlusIconsVue.ZoomIn,at=window.ElementPlusIconsVue.Picture,st=window.ElementPlusIconsVue.DocumentDelete,it=window.ElementPlusIconsVue.WarningFilled,dt=window.ElementPlusIconsVue.Loading,rt={__name:"videos",setup(ut){const $="https://render.setwhat.dpdns.org",J=Xe(),M=i([]),I=i([]),V=i(!1),h=i(!1),R=i(!1),k=i(!1),U=i(!1),N=i(!1),C=i(null),f=i(null),L=i([]),g=i(""),y=i(""),c=i({id:null,title:"",description:"",categoryId:null}),B=i(null),Q={title:[{required:!0,message:"请输入视频标题",trigger:"blur"},{max:100,message:"标题不能超过100个字符",trigger:"blur"}],categoryId:[{required:!0,message:"请选择视频分类",trigger:"change"}]};function X(t){if(!t)return"-";try{const e=new Date(t),p=e.getFullYear(),d=String(e.getMonth()+1).padStart(2,"0"),E=String(e.getDate()).padStart(2,"0"),x=String(e.getHours()).padStart(2,"0"),S=String(e.getMinutes()).padStart(2,"0");return`${p}-${d}-${E} ${x}:${S}`}catch{return t}}async function ee(){try{const t=await F.get(`${$}/api/categories`);t.data&&(t.data.code===0||t.data.code===200)&&(L.value=(t.data.data||t.data).map(e=>({text:e.name,value:e.id})))}catch(t){}}async function D(){V.value=!0;try{const t=await F.get(`${$}/api/admin/videos`);t.data.code===0||t.data.code===200?(M.value=(t.data.data||[]).map(e=>({...e,video_url:e.video_url?`${e.video_url}`:"",cover_url:e.cover_url?`${e.cover_url}`:""})),P(),m.success("加载成功")):m.error(t.data.message||"加载失败")}catch(t){m.error("加载失败，请检查网络连接")}finally{V.value=!1}}function H(){P()}function P(){let t=[...M.value];if(g.value){const e=g.value.toLowerCase().trim();t=t.filter(p=>p.title?.toLowerCase().includes(e)||p.description?.toLowerCase().includes(e))}y.value&&(t=t.filter(e=>e.category_id==y.value)),I.value=t}function O(){g.value="",y.value="",P(),m.info("已重置筛选条件")}const te={"background-color":"#f5f7fa","font-weight":"600",color:"#4e5969","border-bottom":"2px solid #e5e6eb"};function le({row:t,rowIndex:e}){return e%2===0?"table-row-even":"table-row-odd"}function oe(t){return{科技:"primary",娱乐:"success",教育:"info",音乐:"warning",电影:"danger",体育:"success",新闻:"info"}[t]||"default"}function ne(t){f.value=t,N.value=!0}function Y(){}function ae(t){c.value={id:t.id,title:t.title||"",description:t.description||"",categoryId:t.category_id},h.value=!0}async function se(){if(B.value){try{await B.value.validate()}catch{return}R.value=!0;try{const t=await F.put(`${$}/api/admin/videos/${c.value.id}`,{title:c.value.title,description:c.value.description,categoryId:c.value.categoryId});t.data&&(t.data.code===0||t.data.code===200)?(m.success("保存成功"),h.value=!1,await D()):m.error(t.data.message||"保存失败")}catch(t){m.error("保存失败，请重试")}finally{R.value=!1}}}function ie(t){J.push({path:`/admin/details/${t.id}`})}function de(t){C.value=t,k.value=!0}async function re(){if(C.value){U.value=!0;try{const t=await F.delete(`${$}/api/admin/videos/${C.value.id}`);t.data&&(t.data.code===0||t.data.code===200)?(m.success("删除成功"),k.value=!1,C.value=null,await D()):m.error(t.data.message||"删除失败")}catch(t){m.error("删除失败，请重试")}finally{U.value=!1}}}return Qe(()=>{ee().then(()=>D())}),(t,e)=>{const p=v("el-icon"),d=v("el-button"),E=v("el-input"),x=v("el-option"),S=v("el-select"),b=v("el-table-column"),ue=v("el-tag"),ce=v("el-table"),ve=v("el-card"),T=v("el-form-item"),_e=v("el-form"),K=v("el-dialog"),pe=we("loading");return s(),_("div",ye,[a("div",Ve,[e[13]||(e[13]=a("div",{class:"header-left"},[a("h1",{class:"page-title"},"视频管理"),a("p",{class:"page-desc"},"管理所有视频内容，支持编辑、删除和查看详情")],-1)),o(d,{type:"primary",onClick:e[0]||(e[0]=l=>t.$router.push("/admin/upload")),size:"large",class:"upload-btn"},{default:n(()=>[o(p,null,{default:n(()=>[o(r(G))]),_:1}),e[12]||(e[12]=a("span",null,"新增视频",-1))]),_:1,__:[12]})]),o(ve,{class:"main-card",shadow:"hover"},{default:n(()=>[a("div",be,[a("div",he,[a("div",ke,[o(E,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=l=>g.value=l),placeholder:"搜索视频标题或描述","prefix-icon":r(ot),class:"search-input",onKeyup:fe(H,["enter"]),onClear:H,clearable:"",size:"mini"},null,8,["modelValue","prefix-icon"]),o(S,{modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=l=>y.value=l),placeholder:"筛选分类",class:"category-select",onChange:P,clearable:"",size:"mini"},{default:n(()=>[o(x,{value:"",label:"全部分类"}),(s(!0),_(A,null,j(L.value,l=>(s(),z(x,{key:l.value,label:l.text,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(d,{type:"default",onClick:O,icon:r(Z),size:"mini"},{default:n(()=>e[14]||(e[14]=[u(" 重置 ")])),_:1,__:[14]},8,["icon"]),o(d,{type:"primary",onClick:D,icon:r(Z),loading:V.value,size:"mini"},{default:n(()=>e[15]||(e[15]=[u(" 搜索 ")])),_:1,__:[15]},8,["icon","loading"])]),a("div",Ce,[a("div",Ee,[e[16]||(e[16]=a("span",{class:"stat-label"},"视频总数",-1)),a("span",xe,w(M.value.length),1)]),a("div",$e,[e[17]||(e[17]=a("span",{class:"stat-label"},"当前显示",-1)),a("span",Ie,w(I.value.length),1)])])])]),I.value.length?(s(),_("div",De,[ge((s(),z(ce,{data:I.value,style:{width:"100%"},border:"",stripe:"","header-cell-style":te,"row-class-name":le,loading:V.value,"element-loading-text":"加载中..."},{default:n(()=>[o(b,{type:"index",label:"序号",width:"60",align:"center"}),o(b,{label:"封面",width:"180",align:"center"},{default:n(({row:l})=>[a("div",{class:"thumb-container",onClick:q=>ne(l)},[V.value?(s(),_("div",Se,[o(p,{class:"is-loading"},{default:n(()=>[o(r(dt))]),_:1})])):!l.cover_url&&l.video_url?(s(),_("video",{key:1,src:l.video_url,class:"media-thumb",preload:"metadata",onError:Y},null,40,ze)):l.cover_url?(s(),_("img",{key:2,src:l.cover_url,class:"media-thumb",alt:"视频封面",onError:Y},null,40,Fe)):(s(),_("div",Me,[o(p,null,{default:n(()=>[o(r(at))]),_:1}),e[18]||(e[18]=a("span",null,"暂无封面",-1))])),a("div",Re,[o(p,null,{default:n(()=>[o(r(nt))]),_:1})])],8,Pe)]),_:1}),o(b,{prop:"title",label:"标题","min-width":"200"},{default:n(({row:l})=>[a("div",Ue,[a("div",{class:"title-content",title:l.title},w(l.title),9,Ne),l.description?(s(),_("div",{key:0,class:"title-desc",title:l.description},w(l.description),9,Le)):W("",!0)])]),_:1}),o(b,{prop:"category",label:"分类",width:"100",align:"center"},{default:n(({row:l})=>[o(ue,{type:oe(l.category),size:"default"},{default:n(()=>[u(w(l.category),1)]),_:2},1032,["type"])]),_:1}),o(b,{prop:"created_at",label:"创建时间",width:"180",align:"center"},{default:n(({row:l})=>[a("div",Be,w(X(l.created_at)),1)]),_:1}),o(b,{label:"操作",width:"300",align:"center",fixed:"right"},{default:n(({row:l})=>[a("div",Te,[o(d,{size:"small",type:"primary",onClick:q=>ae(l),icon:r(et),class:"action-btn"},{default:n(()=>e[19]||(e[19]=[u(" 编辑 ")])),_:2,__:[19]},1032,["onClick","icon"]),o(d,{size:"small",type:"success",onClick:q=>ie(l),icon:r(lt),class:"action-btn"},{default:n(()=>e[20]||(e[20]=[u(" 详情 ")])),_:2,__:[20]},1032,["onClick","icon"]),o(d,{size:"small",type:"danger",onClick:q=>de(l),icon:r(tt),class:"action-btn"},{default:n(()=>e[21]||(e[21]=[u(" 删除 ")])),_:2,__:[21]},1032,["onClick","icon"])])]),_:1})]),_:1},8,["data","loading"])),[[pe,V.value]])])):(s(),_("div",Ke,[a("div",qe,[o(p,{class:"empty-icon"},{default:n(()=>[o(r(st))]),_:1}),e[24]||(e[24]=a("h3",{class:"empty-title"},"暂无视频数据",-1)),a("p",We,w(g.value||y.value?"没有找到匹配的视频":'请点击"新增视频"按钮上传内容'),1),a("div",Ze,[g.value||y.value?(s(),z(d,{key:0,type:"default",onClick:O,icon:r(Z)},{default:n(()=>e[22]||(e[22]=[u(" 清除筛选 ")])),_:1,__:[22]},8,["icon"])):W("",!0),o(d,{type:"primary",onClick:e[3]||(e[3]=l=>t.$router.push("/admin/upload")),icon:r(G)},{default:n(()=>e[23]||(e[23]=[u(" 新增视频 ")])),_:1,__:[23]},8,["icon"])])])]))]),_:1}),o(K,{modelValue:h.value,"onUpdate:modelValue":e[8]||(e[8]=l=>h.value=l),title:"编辑视频信息",width:"600px","close-on-click-modal":!1,class:"edit-dialog"},{footer:n(()=>[a("div",He,[o(d,{onClick:e[7]||(e[7]=l=>h.value=!1),size:"large"},{default:n(()=>e[25]||(e[25]=[u("取消")])),_:1,__:[25]}),o(d,{type:"primary",loading:R.value,onClick:se,size:"large"},{default:n(()=>e[26]||(e[26]=[u(" 保存修改 ")])),_:1,__:[26]},8,["loading"])])]),default:n(()=>[o(_e,{model:c.value,"label-width":"100px",rules:Q,ref_key:"editFormRef",ref:B},{default:n(()=>[o(T,{label:"视频标题",prop:"title"},{default:n(()=>[o(E,{modelValue:c.value.title,"onUpdate:modelValue":e[4]||(e[4]=l=>c.value.title=l),placeholder:"请输入视频标题",maxlength:100,"show-word-limit":""},null,8,["modelValue"])]),_:1}),o(T,{label:"视频描述",prop:"description"},{default:n(()=>[o(E,{modelValue:c.value.description,"onUpdate:modelValue":e[5]||(e[5]=l=>c.value.description=l),type:"textarea",rows:4,placeholder:"请输入视频描述（可选）",maxlength:500,"show-word-limit":""},null,8,["modelValue"])]),_:1}),o(T,{label:"视频分类",prop:"categoryId"},{default:n(()=>[o(S,{modelValue:c.value.categoryId,"onUpdate:modelValue":e[6]||(e[6]=l=>c.value.categoryId=l),placeholder:"请选择分类",style:{width:"100%"}},{default:n(()=>[(s(!0),_(A,null,j(L.value,l=>(s(),z(x,{key:l.value,label:l.text,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),o(K,{modelValue:k.value,"onUpdate:modelValue":e[10]||(e[10]=l=>k.value=l),title:"确认删除",width:"400px","close-on-click-modal":!1},{footer:n(()=>[a("div",je,[o(d,{onClick:e[9]||(e[9]=l=>k.value=!1),size:"large"},{default:n(()=>e[30]||(e[30]=[u("取消")])),_:1,__:[30]}),o(d,{type:"danger",loading:U.value,onClick:re,size:"large"},{default:n(()=>e[31]||(e[31]=[u(" 确认删除 ")])),_:1,__:[31]},8,["loading"])])]),default:n(()=>[a("div",Oe,[o(p,{class:"delete-icon"},{default:n(()=>[o(r(it))]),_:1}),a("p",Ye,[e[27]||(e[27]=u(" 确认要删除视频 ")),a("strong",null,'"'+w(C.value?.title)+'"',1),e[28]||(e[28]=u(" 吗？ "))]),e[29]||(e[29]=a("p",{class:"delete-warning"},"此操作不可恢复，请谨慎操作",-1))])]),_:1},8,["modelValue"]),o(K,{modelValue:N.value,"onUpdate:modelValue":e[11]||(e[11]=l=>N.value=l),title:"媒体预览",width:"80%",class:"preview-dialog"},{default:n(()=>[a("div",Ae,[f.value&&!f.value.cover_url&&f.value.video_url?(s(),_("video",{key:0,src:f.value.video_url,controls:"",class:"preview-media",autoplay:""},null,8,Ge)):f.value&&f.value.cover_url?(s(),_("img",{key:1,src:f.value.cover_url,class:"preview-media",alt:"封面预览"},null,8,Je)):W("",!0)])]),_:1},8,["modelValue"])])}}},vt=me(rt,[["__scopeId","data-v-45771628"]]);export{vt as default};
