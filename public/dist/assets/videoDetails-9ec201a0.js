import{_ as T}from"./index-dfe38df9.js";const u=window.Vue.resolveComponent,o=window.Vue.createVNode,k=window.Vue.toDisplayString,s=window.Vue.createElementVNode,w=window.Vue.openBlock,x=window.Vue.createElementBlock,O=window.Vue.createCommentVNode,i=window.Vue.createTextVNode,l=window.Vue.withCtx,P=window.Vue.renderList,j=window.Vue.Fragment,z=window.Vue.createBlock,A={class:"video-detail-page"},G={class:"detail-main"},H={class:"detail-title"},J={class:"player-wrap"},K=["src","poster"],Q={class:"detail-info"},W={class:"detail-meta"},X={class:"category"},Y={class:"detail-meta"},Z={class:"desc"},h={class:"detail-actions"},_=window.Vue.ref,ee=window.Vue.onMounted,te=window.VueRouter.useRoute,oe=window.VueRouter.useRouter,V=window.axios,r=window.ElementPlus.ElMessage,le={__name:"videoDetails",setup(ae){const f="https://render.setwhat.dpdns.org",B=te(),C=oe(),d=_({}),v=_(!1),g=_(!1),p=_(!1),n=_({id:null,title:"",description:"",categoryId:null}),b=_([]);async function I(){const t=await V.get(`${f}/api/categories`);t.data&&(t.data.code===0||t.data.code===200)&&(b.value=(t.data.data||t.data).map(e=>({text:e.name,value:e.id})))}async function E(){const t=B.params.id,e=await V.get(`${f}/api/videos/${t}`);if(e.data&&(e.data.code===0||e.data.code===200)){const m=e.data.data;d.value={...m,video_url:`${m.video_url}`,cover_url:`${m.cover_url}`}}}ee(()=>{I().then(()=>E())});function $(){C.back()}function N(){n.value={id:d.value.id,title:d.value.title,description:d.value.description,categoryId:d.value.category_id},v.value=!0}async function U(){if(!n.value.title.trim()){r.warning("请输入标题");return}if(!n.value.categoryId){r.warning("请选择分类");return}g.value=!0;try{const t=await V.put(`${f}/api/admin/videos/${n.value.id}`,{title:n.value.title,description:n.value.description,categoryId:n.value.categoryId});t.data&&(t.data.code===0||t.data.code===200)?(r.success("保存成功"),v.value=!1,await E()):r.error(t.data.message||"保存失败")}catch{r.error("请求出错")}finally{g.value=!1}}function M(){p.value=!0}async function S(){try{const t=await V.delete(`${f}/api/admin/videos/${d.value.id}`);t.data&&(t.data.code===0||t.data.code===200)?(r.success("删除成功"),C.back()):r.error(t.data.message||"删除失败")}catch{r.error("请求出错")}finally{p.value=!1}}return(t,e)=>{const m=u("el-page-header"),c=u("el-button"),D=u("el-input"),y=u("el-form-item"),F=u("el-option"),L=u("el-select"),q=u("el-form"),R=u("el-dialog");return w(),x("div",A,[o(m,{content:"视频详情",onBack:$,class:"page-header"}),s("div",G,[s("div",H,k(d.value.title),1),s("div",J,[d.value.video_url?(w(),x("video",{key:0,src:d.value.video_url,class:"detail-player",controls:"",poster:d.value.cover_url||"",preload:"metadata"},null,8,K)):O("",!0)]),s("div",Q,[s("div",W,[e[7]||(e[7]=i("分类：")),s("span",X,k(d.value.category),1)]),s("div",Y,[e[8]||(e[8]=i("描述：")),s("span",Z,k(d.value.description),1)])]),s("div",h,[o(c,{type:"primary",onClick:N},{default:l(()=>e[9]||(e[9]=[i("编辑")])),_:1,__:[9]}),o(c,{type:"danger",onClick:M},{default:l(()=>e[10]||(e[10]=[i("删除")])),_:1,__:[10]}),o(c,{type:"default",onClick:$},{default:l(()=>e[11]||(e[11]=[i("返回")])),_:1,__:[11]})])]),o(R,{modelValue:v.value,"onUpdate:modelValue":e[4]||(e[4]=a=>v.value=a),title:"编辑视频",width:"500px"},{footer:l(()=>[o(c,{onClick:e[3]||(e[3]=a=>v.value=!1)},{default:l(()=>e[12]||(e[12]=[i("取消")])),_:1,__:[12]}),o(c,{type:"primary",loading:g.value,onClick:U},{default:l(()=>e[13]||(e[13]=[i("保存")])),_:1,__:[13]},8,["loading"])]),default:l(()=>[o(q,{model:n.value,"label-width":"80px"},{default:l(()=>[o(y,{label:"标题",required:""},{default:l(()=>[o(D,{modelValue:n.value.title,"onUpdate:modelValue":e[0]||(e[0]=a=>n.value.title=a)},null,8,["modelValue"])]),_:1}),o(y,{label:"描述"},{default:l(()=>[o(D,{modelValue:n.value.description,"onUpdate:modelValue":e[1]||(e[1]=a=>n.value.description=a)},null,8,["modelValue"])]),_:1}),o(y,{label:"分类",required:""},{default:l(()=>[o(L,{modelValue:n.value.categoryId,"onUpdate:modelValue":e[2]||(e[2]=a=>n.value.categoryId=a),placeholder:"请选择分类"},{default:l(()=>[(w(!0),x(j,null,P(b.value,a=>(w(),z(F,{key:a.value,label:a.text,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),o(R,{modelValue:p.value,"onUpdate:modelValue":e[6]||(e[6]=a=>p.value=a),title:"确认删除",width:"400px"},{footer:l(()=>[o(c,{onClick:e[5]||(e[5]=a=>p.value=!1)},{default:l(()=>e[14]||(e[14]=[i("取消")])),_:1,__:[14]}),o(c,{type:"danger",onClick:S},{default:l(()=>e[15]||(e[15]=[i("确认")])),_:1,__:[15]})]),default:l(()=>[e[16]||(e[16]=s("span",null,"确认要删除该视频吗？",-1))]),_:1,__:[16]},8,["modelValue"])])}}},de=T(le,[["__scopeId","data-v-0ba7ce80"]]);export{de as default};
