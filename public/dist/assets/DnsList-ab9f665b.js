import{h as D}from"./request-aa259f50.js";import{_ as ge}from"./index-dfe38df9.js";const f=window.Vue.unref,e=window.Vue.createVNode,s=window.Vue.resolveComponent,l=window.Vue.withCtx,a=window.Vue.createElementVNode,k=window.Vue.toDisplayString,m=window.Vue.createTextVNode,Ve=window.Vue.resolveDirective,b=window.Vue.openBlock,R=window.Vue.createBlock,le=window.Vue.withDirectives,oe=window.Vue.renderList,ne=window.Vue.Fragment,C=window.Vue.createElementBlock;window.Vue.createCommentVNode;const ye={class:"dns-manager"},he={class:"page-header"},xe={class:"header-content"},Ae={class:"header-left"},De={class:"header-icon-wrapper"},ke={class:"header-right"},Ce={class:"ip-content"},Ie={class:"ip-text"},Te={class:"main-content"},Ee={class:"tab-content"},Ne={class:"tab-header"},Me={class:"domain-cell"},Ue={class:"tab-content"},Re={class:"tab-header"},Le={key:0,class:"comment-text"},Pe={key:1,class:"no-comment"},Se={class:"tab-content"},Fe={class:"dialog-footer"},ze={class:"dialog-footer"},_=window.Vue.ref,q=window.Vue.reactive,Be=window.Vue.onMounted,c=window.ElementPlus.ElMessage,Xe=window.ElementPlus.ElMessageBox,ae=window.ElementPlusIconsVue.Monitor,qe=window.ElementPlusIconsVue.Location,se=window.ElementPlusIconsVue.Refresh,$e=window.ElementPlusIconsVue.View,Ze=window.ElementPlusIconsVue.Edit,je=window.ElementPlusIconsVue.Delete,Oe=window.ElementPlusIconsVue.Plus,de=window.ElementPlusIconsVue.Check,We="70px",Ge={__name:"DnsList",setup(He){const x=_(""),$=_(""),I=_([]),L=_([]),V=_(""),i=_(!1),P=_("zones"),S=_("IP: 正在加载..."),A=_(!1),T=_(!1),y=q({name:""}),F=_(),Z=_(),d=q({zoneId:"",type:"A",name:"",content:"",ttl:3600,proxied:!0,comment:""}),r=q({type:"A",name:"",content:"",ttl:3600,proxied:!0,comment:""}),ie={zoneId:[{required:!0,message:"请选择域名",trigger:"change"}],type:[{required:!0,message:"请选择记录类型",trigger:"change"}],name:[{required:!0,message:"请输入记录名称",trigger:"blur"}],content:[{required:!0,message:"请输入记录内容",trigger:"blur"}],ttl:[{required:!0,message:"请输入TTL值",trigger:"blur"}]},re={type:[{required:!0,message:"请选择记录类型",trigger:"change"}],name:[{required:!0,message:"请输入记录名称",trigger:"blur"}],content:[{required:!0,message:"请输入记录内容",trigger:"blur"}],ttl:[{required:!0,message:"请输入TTL值",trigger:"blur"}]};function ue(n){P.value=n}function j(n){x.value=n,V.value=n,ue("records"),E()}function ce(n){$.value=n;const t=L.value.find(h=>h.id===n);t&&(Object.assign(r,{type:t.type,name:t.name,content:t.content,ttl:t.ttl,proxied:t.proxied,comment:t.comment||""}),A.value=!0)}function O(){Object.assign(d,{zoneId:"",type:"A",name:"",content:"",ttl:3600,proxied:!0,comment:""}),F.value?.resetFields()}function me(n){return{A:"success",AAAA:"warning",CNAME:"info",MX:"danger",TXT:"primary"}[n]||"info"}async function z(){i.value=!0;try{const n=await D.getData("/api-dns/zones");I.value=n.data,c.success("域名列表加载成功")}catch(n){c.error("加载域名列表失败: "+n.message)}finally{i.value=!1}}async function E(){if(V.value){x.value=V.value,i.value=!0;try{const n=await D.getData("/api-dns/dns-records",{zoneId:V.value});L.value=n.data,c.success("DNS记录加载成功")}catch(n){c.error("DNS记录加载失败: "+n.message)}finally{i.value=!1}}}async function pe(){try{await F.value.validate()}catch{return}i.value=!0;try{const n=await D.postData("/api-dns/dns-records",d);c.success("添加记录成功"),O(),j(d.zoneId)}catch(n){c.error("添加记录失败: "+n.message)}finally{i.value=!1}}async function _e(){try{await Z.value.validate()}catch{return}i.value=!0;try{const n=await D.putData("/api-dns/dns-records",{...r,zoneId:x.value,recordId:$.value});c.success("更新记录成功"),A.value=!1,E()}catch(n){c.error("更新记录失败: "+n.message)}finally{i.value=!1}}async function fe(n){if(!x.value){c.warning("未选择任何域名，无法删除");return}try{await Xe.confirm("确定要删除这条记录吗？此操作不可恢复。","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})}catch{return}i.value=!0;try{await D.deleteData("/api-dns/dns-records",{zoneId:x.value,recordId:n}),c.success("删除记录成功"),E()}catch(t){c.error("删除记录失败: "+t.message)}finally{i.value=!1}}async function W(){try{const t=await(await fetch("https://api.ip.sb/geoip")).json();if(t.ip)S.value=`${t.ip} (${t.country})`;else throw new Error("无法解析IP信息")}catch{S.value="获取失败"}}function we(){y.name.trim()==="624331767"?(window.sessionStorage.setItem("userDns",y.name),T.value=!1,c.success("添加成功!"),z(),W()):y.name.trim()===""?c.error("请填写用户名"):c.error("用户名错误!")}return Be(()=>{const n=window.sessionStorage.getItem("userDns")||null;n&&n==="624331767"?(z(),W()):T.value=!0}),(n,t)=>{const h=s("el-icon"),G=s("el-card"),v=s("el-button"),N=s("el-tag"),w=s("el-table-column"),H=s("el-table"),B=s("el-tab-pane"),p=s("el-option"),M=s("el-select"),ve=s("el-button-group"),u=s("el-form-item"),g=s("el-input"),U=s("el-col"),J=s("el-input-number"),K=s("el-switch"),Q=s("el-row"),X=s("el-form"),be=s("el-tabs"),Y=s("el-dialog"),ee=Ve("loading");return b(),C("div",ye,[a("div",he,[a("div",xe,[a("div",Ae,[a("div",De,[e(h,{class:"header-icon"},{default:l(()=>[e(f(ae))]),_:1})]),t[19]||(t[19]=a("div",{class:"header-text"},[a("h1",{class:"header-title"},"Cloudflare域名管理"),a("p",{class:"header-subtitle"},"专业的DNS记录管理工具")],-1))]),a("div",ke,[e(G,{class:"ip-card",shadow:"never"},{default:l(()=>[a("div",Ce,[e(h,{class:"ip-icon"},{default:l(()=>[e(f(qe))]),_:1}),a("span",Ie,k(S.value),1)])]),_:1})])])]),a("div",Te,[e(G,{class:"content-card",shadow:"never"},{default:l(()=>[e(be,{modelValue:P.value,"onUpdate:modelValue":t[8]||(t[8]=o=>P.value=o),type:"border-card",class:"custom-tabs"},{default:l(()=>[e(B,{label:"域名列表",name:"zones"},{default:l(()=>[a("div",Ee,[a("div",Ne,[t[21]||(t[21]=a("div",{class:"tab-title"},[a("h3",null,"域名列表"),a("p",{class:"tab-description"},"管理您的所有Cloudflare域名")],-1)),e(v,{type:"primary",onClick:z,loading:i.value,icon:f(se),class:"refresh-btn"},{default:l(()=>t[20]||(t[20]=[m(" 刷新列表 ")])),_:1,__:[20]},8,["loading","icon"])]),le((b(),R(H,{data:I.value,"empty-text":"暂无域名数据",class:"custom-table",stripe:"","highlight-current-row":""},{default:l(()=>[e(w,{prop:"name",label:"域名","min-width":"250"},{default:l(({row:o})=>[a("div",Me,[e(h,{class:"domain-icon"},{default:l(()=>[e(f(ae))]),_:1}),e(N,{type:"success",effect:"dark"},{default:l(()=>[m(k(o.name),1)]),_:2},1024)])]),_:1}),e(w,{prop:"status",label:"状态",width:"120",align:"center"},{default:l(()=>[e(N,{type:"success",effect:"dark",class:"status-tag"},{default:l(()=>[e(h,null,{default:l(()=>[e(f(de))]),_:1}),t[22]||(t[22]=m(" 活跃 "))]),_:1,__:[22]})]),_:1}),e(w,{label:"操作",width:"150",align:"center",fixed:"right"},{default:l(({row:o})=>[e(v,{type:"primary",onClick:te=>j(o.id),icon:f($e),class:"action-btn"},{default:l(()=>t[23]||(t[23]=[m(" 查看记录 ")])),_:2,__:[23]},1032,["onClick","icon"])]),_:1})]),_:1},8,["data"])),[[ee,i.value]])])]),_:1}),e(B,{label:"DNS记录",name:"records"},{default:l(()=>[a("div",Ue,[a("div",Re,[t[24]||(t[24]=a("div",{class:"tab-title"},[a("h3",null,"DNS记录"),a("p",{class:"tab-description"},"管理选定域名的DNS记录")],-1)),e(M,{modelValue:V.value,"onUpdate:modelValue":t[0]||(t[0]=o=>V.value=o),placeholder:"请选择域名",style:{width:"350px"},onChange:E,clearable:"",class:"zone-select"},{default:l(()=>[(b(!0),C(ne,null,oe(I.value,o=>(b(),R(p,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),le((b(),R(H,{data:L.value,"empty-text":"请选择域名查看DNS记录",class:"custom-table",stripe:"",height:"450","highlight-current-row":""},{default:l(()=>[e(w,{prop:"type",label:"类型",width:"100",align:"center"},{default:l(({row:o})=>[e(N,{type:me(o.type),effect:"dark",class:"type-tag"},{default:l(()=>[m(k(o.type),1)]),_:2},1032,["type"])]),_:1}),e(w,{prop:"name",label:"名称","min-width":"150"}),e(w,{prop:"content",label:"内容","min-width":"200","show-overflow-tooltip":""}),e(w,{prop:"ttl",label:"TTL",width:"100",align:"center"}),e(w,{prop:"comment",label:"备注","min-width":"120","show-overflow-tooltip":""},{default:l(({row:o})=>[o.comment?(b(),C("span",Le,k(o.comment),1)):(b(),C("span",Pe,"-"))]),_:1}),e(w,{prop:"proxied",label:"代理状态",width:"120",align:"center"},{default:l(({row:o})=>[e(N,{type:o.proxied?"success":"warning",effect:"dark",class:"proxy-tag"},{default:l(()=>[m(k(o.proxied?"已代理":"未代理"),1)]),_:2},1032,["type"])]),_:1}),e(w,{label:"操作",width:"200",align:"center",fixed:"right"},{default:l(({row:o})=>[e(ve,{class:"action-group"},{default:l(()=>[e(v,{type:"primary",onClick:te=>ce(o.id),icon:f(Ze),class:"action-btn"},{default:l(()=>t[25]||(t[25]=[m(" 编辑 ")])),_:2,__:[25]},1032,["onClick","icon"]),e(v,{type:"danger",onClick:te=>fe(o.id),icon:f(je),class:"action-btn"},{default:l(()=>t[26]||(t[26]=[m(" 删除 ")])),_:2,__:[26]},1032,["onClick","icon"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[ee,i.value]])])]),_:1}),e(B,{label:"添加记录",name:"add"},{default:l(()=>[a("div",Se,[t[29]||(t[29]=a("div",{class:"tab-header"},[a("div",{class:"tab-title"},[a("h3",null,"添加DNS记录"),a("p",{class:"tab-description"},"为选定域名添加新的DNS记录")])],-1)),e(X,{ref_key:"addFormRef",ref:F,model:d,rules:ie,"label-width":"120px",class:"add-form"},{default:l(()=>[e(Q,{gutter:30},{default:l(()=>[e(U,{span:12},{default:l(()=>[e(u,{label:"选择域名",prop:"zoneId"},{default:l(()=>[e(M,{modelValue:d.zoneId,"onUpdate:modelValue":t[1]||(t[1]=o=>d.zoneId=o),placeholder:"请选择域名",style:{width:"100%"},clearable:""},{default:l(()=>[(b(!0),C(ne,null,oe(I.value,o=>(b(),R(p,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"记录类型",prop:"type"},{default:l(()=>[e(M,{modelValue:d.type,"onUpdate:modelValue":t[2]||(t[2]=o=>d.type=o),placeholder:"请选择记录类型",style:{width:"100%"}},{default:l(()=>[e(p,{label:"A",value:"A"}),e(p,{label:"AAAA",value:"AAAA"}),e(p,{label:"CNAME",value:"CNAME"}),e(p,{label:"MX",value:"MX"}),e(p,{label:"TXT",value:"TXT"})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"备注",prop:"comment"},{default:l(()=>[e(g,{modelValue:d.comment,"onUpdate:modelValue":t[3]||(t[3]=o=>d.comment=o),placeholder:"例如：公司用",clearable:"","show-word-limit":"",maxlength:"100"},null,8,["modelValue"])]),_:1})]),_:1}),e(U,{span:12},{default:l(()=>[e(u,{label:"记录名称",prop:"name"},{default:l(()=>[e(g,{modelValue:d.name,"onUpdate:modelValue":t[4]||(t[4]=o=>d.name=o),placeholder:"例如：www",clearable:""},null,8,["modelValue"])]),_:1}),e(u,{label:"记录内容",prop:"content"},{default:l(()=>[e(g,{modelValue:d.content,"onUpdate:modelValue":t[5]||(t[5]=o=>d.content=o),placeholder:"例如：192.168.1.1",clearable:""},null,8,["modelValue"])]),_:1}),e(u,{label:"TTL",prop:"ttl"},{default:l(()=>[e(J,{modelValue:d.ttl,"onUpdate:modelValue":t[6]||(t[6]=o=>d.ttl=o),min:1,max:86400,style:{width:"100%"},"controls-position":"right"},null,8,["modelValue"])]),_:1}),e(u,{label:"启用代理",prop:"proxied"},{default:l(()=>[e(K,{modelValue:d.proxied,"onUpdate:modelValue":t[7]||(t[7]=o=>d.proxied=o),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(u,{class:"form-actions"},{default:l(()=>[e(v,{type:"primary",onClick:pe,loading:i.value,icon:f(Oe),class:"submit-btn"},{default:l(()=>t[27]||(t[27]=[m(" 添加记录 ")])),_:1,__:[27]},8,["loading","icon"]),e(v,{onClick:O,icon:f(se),class:"reset-btn"},{default:l(()=>t[28]||(t[28]=[m(" 重置表单 ")])),_:1,__:[28]},8,["icon"])]),_:1})]),_:1},8,["model"])])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),e(Y,{modelValue:A.value,"onUpdate:modelValue":t[16]||(t[16]=o=>A.value=o),title:"编辑DNS记录",width:"700px","close-on-click-modal":!1,class:"edit-dialog"},{footer:l(()=>[a("div",Fe,[e(v,{onClick:t[15]||(t[15]=o=>A.value=!1)},{default:l(()=>t[30]||(t[30]=[m("取消")])),_:1,__:[30]}),e(v,{type:"primary",onClick:_e,loading:i.value,icon:f(de)},{default:l(()=>t[31]||(t[31]=[m(" 保存更改 ")])),_:1,__:[31]},8,["loading","icon"])])]),default:l(()=>[e(X,{ref_key:"editFormRef",ref:Z,model:r,rules:re,"label-width":"120px"},{default:l(()=>[e(Q,{gutter:30},{default:l(()=>[e(U,{span:12},{default:l(()=>[e(u,{label:"记录类型",prop:"type"},{default:l(()=>[e(M,{modelValue:r.type,"onUpdate:modelValue":t[9]||(t[9]=o=>r.type=o),placeholder:"请选择记录类型",style:{width:"100%"}},{default:l(()=>[e(p,{label:"A",value:"A"}),e(p,{label:"AAAA",value:"AAAA"}),e(p,{label:"CNAME",value:"CNAME"}),e(p,{label:"MX",value:"MX"}),e(p,{label:"TXT",value:"TXT"})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"记录名称",prop:"name"},{default:l(()=>[e(g,{modelValue:r.name,"onUpdate:modelValue":t[10]||(t[10]=o=>r.name=o),clearable:""},null,8,["modelValue"])]),_:1}),e(u,{label:"备注",prop:"comment"},{default:l(()=>[e(g,{modelValue:r.comment,"onUpdate:modelValue":t[11]||(t[11]=o=>r.comment=o),clearable:"","show-word-limit":"",maxlength:"100"},null,8,["modelValue"])]),_:1})]),_:1}),e(U,{span:12},{default:l(()=>[e(u,{label:"记录内容",prop:"content"},{default:l(()=>[e(g,{modelValue:r.content,"onUpdate:modelValue":t[12]||(t[12]=o=>r.content=o),clearable:""},null,8,["modelValue"])]),_:1}),e(u,{label:"TTL",prop:"ttl"},{default:l(()=>[e(J,{modelValue:r.ttl,"onUpdate:modelValue":t[13]||(t[13]=o=>r.ttl=o),min:1,max:86400,style:{width:"100%"},"controls-position":"right"},null,8,["modelValue"])]),_:1}),e(u,{label:"启用代理",prop:"proxied"},{default:l(()=>[e(K,{modelValue:r.proxied,"onUpdate:modelValue":t[14]||(t[14]=o=>r.proxied=o),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(Y,{modelValue:T.value,"onUpdate:modelValue":t[18]||(t[18]=o=>T.value=o),title:"请填写用户名",width:"500","show-close":!1,"close-on-press-escape":!1,"close-on-click-modal":!1,top:"25vh"},{footer:l(()=>[a("div",ze,[e(v,{type:"primary",onClick:we},{default:l(()=>t[32]||(t[32]=[m(" 确定 ")])),_:1,__:[32]})])]),default:l(()=>[e(X,{model:y},{default:l(()=>[e(u,{label:"用户名","label-width":We},{default:l(()=>[e(g,{modelValue:y.name,"onUpdate:modelValue":t[17]||(t[17]=o=>y.name=o),autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Qe=ge(Ge,[["__scopeId","data-v-7674b93a"]]);export{Qe as default};
