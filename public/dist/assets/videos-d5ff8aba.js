import{_ as ie}from"./index-7bac68dc.js";const d=window.Vue.createElementVNode,x=window.Vue.unref,o=window.Vue.createVNode,s=window.Vue.resolveComponent,n=window.Vue.withCtx,u=window.Vue.createTextVNode,se=window.Vue.withKeys,K=window.Vue.renderList,q=window.Vue.Fragment,c=window.Vue.openBlock,_=window.Vue.createElementBlock,F=window.Vue.createBlock,ue=window.Vue.createCommentVNode,P=window.Vue.toDisplayString,re={class:"video-admin-page"},ce={class:"page-header"},pe={class:"main-content"},ve={class:"filter-bar"},_e={class:"thumb-container"},me=["src"],fe=["src"],we={class:"title-content"},ge={class:"desc-content"},ye={key:1,class:"empty-state"},Ve={key:2,class:"pagination-container"},i=window.Vue.ref,be=window.Vue.onMounted;window.Vue.computed;const E=window.axios,p=window.ElementPlus.ElMessage,Ce=window.VueRouter.useRouter,ke=window.ElementPlusIconsVue.UploadFilled,xe=window.ElementPlusIconsVue.Edit,Ee=window.ElementPlusIconsVue.Delete,he=window.ElementPlusIconsVue.Eye;window.ElementPlusIconsVue.Search;const $e={__name:"videos",setup(Ie){const C="http://192.168.101.238:3001",f=i([]),B=i([]),h=i(!1),w=i(!1),$=i(!1),g=i(!1),I=i(null),z=i([]),y=i(""),V=i(""),b=i(1),L=i(10),a=i({id:null,title:"",description:"",categoryId:null}),j=Ce();async function O(){const t=await E.get(`${C}/api/categories`);t.data&&(t.data.code===0||t.data.code===200)&&(z.value=(t.data.data||t.data).map(e=>({text:e.name,value:e.id})))}async function S(){h.value=!0;try{const t=await E.get(`${C}/api/admin/videos`);t.data&&(t.data.code===0||t.data.code===200)&&(f.value=t.data.data.map(e=>({...e,video_url:`${e.video_url}`,cover_url:`${e.cover_url}`})),k())}catch{p.error("加载失败")}finally{h.value=!1}}be(()=>{O().then(()=>S())});function A(){b.value=1,k()}function k(){let t=[...f.value];if(y.value){const e=y.value.toLowerCase();t=t.filter(v=>v.title.toLowerCase().includes(e)||v.description.toLowerCase().includes(e))}V.value&&(t=t.filter(e=>e.category_id===V.value)),B.value=t}function G(){y.value="",V.value="",b.value=1,k()}function H(t){L.value=t,b.value=1}function J(t){b.value=t}const Q={"background-color":"#f5f7fa","font-weight":"600",color:"#4e5969","border-bottom":"1px solid #e5e6eb"};function W({row:t,rowIndex:e}){return e%2===0?"table-row-even":"table-row-odd"}function X(t){return{科技:"primary",娱乐:"success",教育:"info",音乐:"warning",电影:"danger"}[t]||"default"}function Y(t){a.value={id:t.id,title:t.title,description:t.description,categoryId:t.category_id},w.value=!0}async function Z(){if(!a.value.title.trim()){p.warning("请输入标题");return}if(!a.value.categoryId){p.warning("请选择分类");return}$.value=!0;try{const t=await E.put(`${C}/api/admin/videos/${a.value.id}`,{title:a.value.title,description:a.value.description,categoryId:a.value.categoryId});t.data&&(t.data.code===0||t.data.code===200)?(p.success("保存成功"),w.value=!1,await S()):p.error(t.data.message||"保存失败")}catch{p.error("请求出错")}finally{$.value=!1}}function ee(t){j.push({path:`/admin/details/${t.id}`})}function te(t){I.value=t,g.value=!0}async function le(){if(I.value)try{const t=await E.delete(`${C}/api/admin/videos/${I.value.id}`);t.data&&(t.data.code===0||t.data.code===200)?(p.success("删除成功"),g.value=!1,await S()):p.error(t.data.message||"删除失败")}catch{p.error("请求出错")}}return(t,e)=>{const v=s("el-icon"),r=s("el-button"),U=s("el-input"),N=s("el-option"),M=s("el-select"),m=s("el-table-column"),oe=s("el-tag"),ne=s("el-table"),ae=s("el-pagination"),D=s("el-form-item"),de=s("el-form"),R=s("el-dialog");return c(),_("div",re,[d("div",ce,[e[12]||(e[12]=d("div",{class:"header-content"},[d("h1",null,"视频管理"),d("p",{class:"header-desc"},"管理所有视频内容，支持编辑、删除和查看详情")],-1)),o(r,{type:"primary",onClick:e[0]||(e[0]=l=>t.$router.push("/admin/upload")),class:"upload-btn"},{default:n(()=>[o(v,null,{default:n(()=>[o(x(ke))]),_:1}),e[11]||(e[11]=u(" 新增视频 "))]),_:1,__:[11]})]),d("div",pe,[d("div",ve,[o(U,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=l=>y.value=l),placeholder:"搜索视频标题","prefix-icon":"Search",class:"search-input",onKeyup:se(A,["enter"])},null,8,["modelValue"]),o(M,{modelValue:V.value,"onUpdate:modelValue":e[2]||(e[2]=l=>V.value=l),placeholder:"筛选分类",class:"category-select",onChange:k},{default:n(()=>[o(N,{value:"",label:"全部分类"}),(c(!0),_(q,null,K(z.value,l=>(c(),F(N,{key:l.value,label:l.text,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(r,{type:"default",onClick:G},{default:n(()=>e[13]||(e[13]=[u("重置筛选")])),_:1,__:[13]})]),f.value.length?(c(),F(ne,{key:0,data:B.value,style:{width:"100%"},border:"",stripe:"","header-cell-style":Q,"row-class-name":W,loading:h.value},{default:n(()=>[o(m,{type:"index",label:"序号",width:"60",align:"center"}),o(m,{label:"缩略图",width:"180",align:"center"},{default:n(({row:l})=>[d("div",_e,[l.cover_url?(c(),_("img",{key:1,src:l.cover_url,class:"img-thumb",alt:"视频封面"},null,8,fe)):(c(),_("video",{key:0,src:l.video_url,class:"video-thumb",controls:"",preload:"metadata"},null,8,me))])]),_:1}),o(m,{prop:"title",label:"标题","min-width":"200"},{default:n(({row:l})=>[d("div",we,P(l.title),1)]),_:1}),o(m,{prop:"category",label:"分类",width:"100",align:"center"},{default:n(({row:l})=>[o(oe,{type:X(l.category)},{default:n(()=>[u(P(l.category),1)]),_:2},1032,["type"])]),_:1}),o(m,{prop:"description",label:"描述","min-width":"250"},{default:n(({row:l})=>[d("div",ge,P(l.description||"无描述"),1)]),_:1}),o(m,{label:"操作",width:"330",align:"center"},{default:n(({row:l})=>[o(r,{size:"mini",type:"primary",onClick:T=>Y(l),class:"action-btn edit-btn"},{default:n(()=>[o(v,null,{default:n(()=>[o(x(xe))]),_:1}),e[14]||(e[14]=u(" 编辑 "))]),_:2,__:[14]},1032,["onClick"]),o(r,{size:"mini",type:"danger",onClick:T=>te(l),class:"action-btn delete-btn"},{default:n(()=>[o(v,null,{default:n(()=>[o(x(Ee))]),_:1}),e[15]||(e[15]=u(" 删除 "))]),_:2,__:[15]},1032,["onClick"]),o(r,{size:"mini",type:"success",onClick:T=>ee(l),class:"action-btn view-btn"},{default:n(()=>[o(v,null,{default:n(()=>[o(x(he))]),_:1}),e[16]||(e[16]=u(" 详情 "))]),_:2,__:[16]},1032,["onClick"])]),_:1})]),_:1},8,["data","loading"])):(c(),_("div",ye,[e[18]||(e[18]=d("img",{src:"https://img.yzcdn.cn/vant/empty-image-default.png",class:"empty-img"},null,-1)),e[19]||(e[19]=d("div",{class:"empty-text"},[d("h3",null,"暂无视频数据"),d("p",null,'请点击"新增视频"按钮上传内容')],-1)),o(r,{type:"primary",onClick:e[3]||(e[3]=l=>t.$router.push("/admin/upload")),class:"empty-action"},{default:n(()=>e[17]||(e[17]=[u(" 新增视频 ")])),_:1,__:[17]})])),f.value.length?(c(),_("div",Ve,[o(ae,{onSizeChange:H,onCurrentChange:J,"current-page":b.value,"page-sizes":[5,10,20,50],"page-size":L.value,layout:"total, sizes, prev, pager, next, jumper",total:f.value.length},null,8,["current-page","page-size","total"])])):ue("",!0)]),o(R,{modelValue:w.value,"onUpdate:modelValue":e[8]||(e[8]=l=>w.value=l),title:"编辑视频",width:"500px"},{footer:n(()=>[o(r,{onClick:e[7]||(e[7]=l=>w.value=!1)},{default:n(()=>e[20]||(e[20]=[u("取消")])),_:1,__:[20]}),o(r,{type:"primary",loading:$.value,onClick:Z},{default:n(()=>e[21]||(e[21]=[u("保存")])),_:1,__:[21]},8,["loading"])]),default:n(()=>[o(de,{model:a.value,"label-width":"80px"},{default:n(()=>[o(D,{label:"标题",required:""},{default:n(()=>[o(U,{modelValue:a.value.title,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.title=l)},null,8,["modelValue"])]),_:1}),o(D,{label:"描述"},{default:n(()=>[o(U,{modelValue:a.value.description,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.description=l),type:"textarea",rows:"4"},null,8,["modelValue"])]),_:1}),o(D,{label:"分类",required:""},{default:n(()=>[o(M,{modelValue:a.value.categoryId,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.categoryId=l),placeholder:"请选择分类"},{default:n(()=>[(c(!0),_(q,null,K(z.value,l=>(c(),F(N,{key:l.value,label:l.text,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),o(R,{modelValue:g.value,"onUpdate:modelValue":e[10]||(e[10]=l=>g.value=l),title:"确认删除",width:"400px"},{footer:n(()=>[o(r,{onClick:e[9]||(e[9]=l=>g.value=!1)},{default:n(()=>e[22]||(e[22]=[u("取消")])),_:1,__:[22]}),o(r,{type:"danger",onClick:le},{default:n(()=>e[23]||(e[23]=[u("确认")])),_:1,__:[23]})]),default:n(()=>[e[24]||(e[24]=d("span",null,"确认要删除该视频吗？此操作不可恢复",-1))]),_:1,__:[24]},8,["modelValue"])])}}},Se=ie($e,[["__scopeId","data-v-d00f99fb"]]);export{Se as default};
