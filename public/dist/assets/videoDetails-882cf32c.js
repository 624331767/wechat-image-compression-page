import{_ as ee}from"./index-941795e8.js";const u=window.Vue.unref,d=window.Vue.createTextVNode,_=window.Vue.resolveComponent,n=window.Vue.withCtx,o=window.Vue.createVNode,t=window.Vue.createElementVNode,g=window.Vue.toDisplayString,v=window.Vue.openBlock,m=window.Vue.createElementBlock,B=window.Vue.createCommentVNode,te=window.Vue.resolveDirective,U=window.Vue.createBlock,oe=window.Vue.withDirectives,le=window.Vue.renderList,ne=window.Vue.Fragment,ae={class:"video-detail-container"},se={class:"header-bar"},ie={class:"video-header"},de={class:"video-title"},re={class:"video-meta"},ue={key:0,class:"create-time"},ce={class:"player-section"},_e={class:"player-wrapper"},ve=["src","poster"],pe={key:1,class:"player-placeholder"},fe={class:"info-section"},me={class:"section-title"},ge={class:"info-content"},we={class:"info-item"},ye={class:"info-label"},Ve={class:"info-value"},ke={key:0,class:"info-item"},Ee={class:"info-label"},be={class:"info-value"},xe={class:"description-text"},Ce={key:1,class:"info-item"},De={class:"info-label"},he={key:2,class:"info-item"},Ie={class:"info-label"},$e={class:"info-value"},ze={class:"action-section"},Pe={class:"dialog-footer"},Re={class:"delete-content"},Fe={class:"delete-text"},Se={class:"dialog-footer"},p=window.Vue.ref,Me=window.Vue.onMounted,Ne=window.VueRouter.useRoute,Be=window.VueRouter.useRouter,x=window.axios,f=window.ElementPlus.ElMessage,L=window.ElementPlusIconsVue.ArrowLeft,Ue=window.ElementPlusIconsVue.Edit,Le=window.ElementPlusIconsVue.Delete,Te=window.ElementPlusIconsVue.Document,Oe=window.ElementPlusIconsVue.FolderOpened,T=window.ElementPlusIconsVue.EditPen,O=window.ElementPlusIconsVue.Clock,qe=window.ElementPlusIconsVue.VideoCamera,Ae=window.ElementPlusIconsVue.WarningFilled,We={__name:"videoDetails",setup(He){const V="https://render.setwhat.dpdns.org",q=Ne(),k=Be(),a=p({}),C=p(!1),w=p(!1),D=p(!1),h=p(!1),y=p(!1),r=p({id:null,title:"",description:"",categoryId:null}),P=p([]),I=p(null),A={title:[{required:!0,message:"请输入视频标题",trigger:"blur"},{max:100,message:"标题不能超过100个字符",trigger:"blur"}],categoryId:[{required:!0,message:"请选择视频分类",trigger:"change"}]};function R(l){if(!l)return"-";try{const e=new Date(l),s=e.getFullYear(),E=String(e.getMonth()+1).padStart(2,"0"),c=String(e.getDate()).padStart(2,"0"),$=String(e.getHours()).padStart(2,"0"),b=String(e.getMinutes()).padStart(2,"0");return`${s}-${E}-${c} ${$}:${b}`}catch{return l}}function F(l){return{科技:"primary",娱乐:"success",教育:"info",音乐:"warning",电影:"danger",体育:"success",新闻:"info"}[l]||"default"}async function W(){try{const l=await x.get(`${V}/api/categories`);l.data&&(l.data.code===0||l.data.code===200)&&(P.value=(l.data.data||l.data).map(e=>({text:e.name,value:e.id})))}catch(l){}}async function S(){C.value=!0;try{const l=q.params.id,e=await x.get(`${V}/api/videos/${l}`);if(e.data&&(e.data.code===0||e.data.code===200)){const s=e.data.data;a.value={...s,video_url:s.video_url?`${s.video_url}`:"",cover_url:s.cover_url?`${s.cover_url}`:""}}else f.error(e.data.message||"加载失败"),k.back()}catch(l){f.error("加载失败，请检查网络连接"),k.back()}finally{C.value=!1}}function H(){f.warning("视频加载失败，请检查视频地址")}function M(){k.back()}function Y(){r.value={id:a.value.id,title:a.value.title||"",description:a.value.description||"",categoryId:a.value.category_id},w.value=!0}async function j(){if(I.value){try{await I.value.validate()}catch{return}D.value=!0;try{const l=await x.put(`${V}/api/admin/videos/${r.value.id}`,{title:r.value.title,description:r.value.description,categoryId:r.value.categoryId});l.data&&(l.data.code===0||l.data.code===200)?(f.success("保存成功"),w.value=!1,await S()):f.error(l.data.message||"保存失败")}catch(l){f.error("保存失败，请重试")}finally{D.value=!1}}}function G(){y.value=!0}async function J(){h.value=!0;try{const l=await x.delete(`${V}/api/admin/videos/${a.value.id}`);l.data&&(l.data.code===0||l.data.code===200)?(f.success("删除成功"),k.back()):f.error(l.data.message||"删除失败")}catch(l){f.error("删除失败，请重试")}finally{h.value=!1,y.value=!1}}return Me(()=>{W().then(()=>S())}),(l,e)=>{const s=_("el-button"),E=_("el-tag"),c=_("el-icon"),$=_("el-card"),b=_("el-input"),z=_("el-form-item"),K=_("el-option"),Q=_("el-select"),X=_("el-form"),N=_("el-dialog"),Z=te("loading");return v(),m("div",ae,[t("div",se,[o(s,{type:"text",icon:u(L),onClick:M,class:"back-btn",size:"large"},{default:n(()=>e[7]||(e[7]=[d(" 返回 ")])),_:1,__:[7]},8,["icon"]),e[8]||(e[8]=t("h1",{class:"page-title"},"视频详情",-1)),e[9]||(e[9]=t("div",{class:"header-placeholder"},null,-1))]),oe((v(),U($,{class:"detail-card",shadow:"hover"},{default:n(()=>[t("div",ie,[t("h2",de,g(a.value.title||"加载中..."),1),t("div",re,[o(E,{type:F(a.value.category),size:"large",class:"category-tag"},{default:n(()=>[d(g(a.value.category||"未分类"),1)]),_:1},8,["type"]),a.value.created_at?(v(),m("span",ue,[o(c,null,{default:n(()=>[o(u(O))]),_:1}),d(" "+g(R(a.value.created_at)),1)])):B("",!0)])]),t("div",ce,[t("div",_e,[a.value.video_url?(v(),m("video",{key:0,src:a.value.video_url,class:"detail-player",controls:"",poster:a.value.cover_url||"",preload:"metadata",onError:H}," 您的浏览器不支持视频播放 ",40,ve)):(v(),m("div",pe,[o(c,{class:"placeholder-icon"},{default:n(()=>[o(u(qe))]),_:1}),e[10]||(e[10]=t("p",null,"视频加载失败",-1))]))])]),t("div",fe,[t("div",me,[o(c,null,{default:n(()=>[o(u(Te))]),_:1}),e[11]||(e[11]=t("span",null,"视频信息",-1))]),t("div",ge,[t("div",we,[t("div",ye,[o(c,null,{default:n(()=>[o(u(Oe))]),_:1}),e[12]||(e[12]=t("span",null,"分类",-1))]),t("div",Ve,[o(E,{type:F(a.value.category),size:"default"},{default:n(()=>[d(g(a.value.category||"未分类"),1)]),_:1},8,["type"])])]),a.value.description?(v(),m("div",ke,[t("div",Ee,[o(c,null,{default:n(()=>[o(u(T))]),_:1}),e[13]||(e[13]=t("span",null,"描述",-1))]),t("div",be,[t("p",xe,g(a.value.description),1)])])):(v(),m("div",Ce,[t("div",De,[o(c,null,{default:n(()=>[o(u(T))]),_:1}),e[14]||(e[14]=t("span",null,"描述",-1))]),e[15]||(e[15]=t("div",{class:"info-value"},[t("span",{class:"empty-text"},"暂无描述")],-1))])),a.value.created_at?(v(),m("div",he,[t("div",Ie,[o(c,null,{default:n(()=>[o(u(O))]),_:1}),e[16]||(e[16]=t("span",null,"创建时间",-1))]),t("div",$e,[t("span",null,g(R(a.value.created_at)),1)])])):B("",!0)])]),t("div",ze,[o(s,{type:"primary",onClick:Y,size:"large",icon:u(Ue),class:"action-btn"},{default:n(()=>e[17]||(e[17]=[d(" 编辑信息 ")])),_:1,__:[17]},8,["icon"]),o(s,{type:"danger",onClick:G,size:"large",icon:u(Le),class:"action-btn"},{default:n(()=>e[18]||(e[18]=[d(" 删除视频 ")])),_:1,__:[18]},8,["icon"]),o(s,{type:"default",onClick:M,size:"large",icon:u(L),class:"action-btn"},{default:n(()=>e[19]||(e[19]=[d(" 返回列表 ")])),_:1,__:[19]},8,["icon"])])]),_:1})),[[Z,C.value]]),o(N,{modelValue:w.value,"onUpdate:modelValue":e[4]||(e[4]=i=>w.value=i),title:"编辑视频信息",width:"600px","close-on-click-modal":!1,class:"edit-dialog"},{footer:n(()=>[t("div",Pe,[o(s,{onClick:e[3]||(e[3]=i=>w.value=!1),size:"large"},{default:n(()=>e[20]||(e[20]=[d("取消")])),_:1,__:[20]}),o(s,{type:"primary",loading:D.value,onClick:j,size:"large"},{default:n(()=>e[21]||(e[21]=[d(" 保存修改 ")])),_:1,__:[21]},8,["loading"])])]),default:n(()=>[o(X,{model:r.value,"label-width":"100px",rules:A,ref_key:"editFormRef",ref:I},{default:n(()=>[o(z,{label:"视频标题",prop:"title"},{default:n(()=>[o(b,{modelValue:r.value.title,"onUpdate:modelValue":e[0]||(e[0]=i=>r.value.title=i),placeholder:"请输入视频标题",maxlength:100,"show-word-limit":"",size:"large"},null,8,["modelValue"])]),_:1}),o(z,{label:"视频描述",prop:"description"},{default:n(()=>[o(b,{modelValue:r.value.description,"onUpdate:modelValue":e[1]||(e[1]=i=>r.value.description=i),type:"textarea",rows:4,placeholder:"请输入视频描述（可选）",maxlength:500,"show-word-limit":""},null,8,["modelValue"])]),_:1}),o(z,{label:"视频分类",prop:"categoryId"},{default:n(()=>[o(Q,{modelValue:r.value.categoryId,"onUpdate:modelValue":e[2]||(e[2]=i=>r.value.categoryId=i),placeholder:"请选择分类",style:{width:"100%"},size:"large"},{default:n(()=>[(v(!0),m(ne,null,le(P.value,i=>(v(),U(K,{key:i.value,label:i.text,value:i.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),o(N,{modelValue:y.value,"onUpdate:modelValue":e[6]||(e[6]=i=>y.value=i),title:"确认删除",width:"400px","close-on-click-modal":!1},{footer:n(()=>[t("div",Se,[o(s,{onClick:e[5]||(e[5]=i=>y.value=!1),size:"large"},{default:n(()=>e[25]||(e[25]=[d("取消")])),_:1,__:[25]}),o(s,{type:"danger",loading:h.value,onClick:J,size:"large"},{default:n(()=>e[26]||(e[26]=[d(" 确认删除 ")])),_:1,__:[26]},8,["loading"])])]),default:n(()=>[t("div",Re,[o(c,{class:"delete-icon"},{default:n(()=>[o(u(Ae))]),_:1}),t("p",Fe,[e[22]||(e[22]=d("确认要删除视频 ")),t("strong",null,'"'+g(a.value.title)+'"',1),e[23]||(e[23]=d(" 吗？"))]),e[24]||(e[24]=t("p",{class:"delete-warning"},"此操作不可恢复，请谨慎操作",-1))])]),_:1},8,["modelValue"])])}}},je=ee(We,[["__scopeId","data-v-34fc6677"]]);export{je as default};
