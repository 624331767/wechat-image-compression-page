import{_ as oe}from"./index-dfe38df9.js";const d=window.Vue.createElementVNode,k=window.Vue.unref,o=window.Vue.createVNode,i=window.Vue.resolveComponent,n=window.Vue.withCtx,u=window.Vue.createTextVNode,ne=window.Vue.withKeys,z=window.Vue.renderList,K=window.Vue.Fragment,c=window.Vue.openBlock,_=window.Vue.createElementBlock,F=window.Vue.createBlock;window.Vue.createCommentVNode;const P=window.Vue.toDisplayString,ae={class:"video-admin-page"},de={class:"page-header"},se={class:"main-content"},ie={class:"filter-bar"},ue={class:"thumb-container"},re=["src"],ce=["src"],pe={class:"title-content"},ve={class:"desc-content"},me={key:1,class:"empty-state"},s=window.Vue.ref,_e=window.Vue.onMounted;window.Vue.computed;const C=window.axios,p=window.ElementPlus.ElMessage,fe=window.VueRouter.useRouter,we=window.ElementPlusIconsVue.UploadFilled,ye=window.ElementPlusIconsVue.Edit,ge=window.ElementPlusIconsVue.Delete,Ve=window.ElementPlusIconsVue.Eye;window.ElementPlusIconsVue.Search;const be={__name:"videos",setup(ke){const V="https://render.setwhat.dpdns.org",E=s([]),B=s([]),x=s(!1),f=s(!1),$=s(!1),w=s(!1),I=s(null),h=s([]),y=s(""),g=s(""),L=s(1);s(10);const a=s({id:null,title:"",description:"",categoryId:null}),q=fe();async function O(){const t=await C.get(`${V}/api/categories`);t.data&&(t.data.code===0||t.data.code===200)&&(h.value=(t.data.data||t.data).map(e=>({text:e.name,value:e.id})))}async function U(){x.value=!0;try{const t=await C.get(`${V}/api/admin/videos`);t.data&&(t.data.code===0||t.data.code===200)&&(E.value=t.data.data.map(e=>({...e,video_url:`${e.video_url}`,cover_url:`${e.cover_url}`})),b())}catch{p.error("加载失败")}finally{x.value=!1}}_e(()=>{O().then(()=>U())});function j(){L.value=1,b()}function b(){let t=[...E.value];if(y.value){const e=y.value.toLowerCase();t=t.filter(v=>v.title.toLowerCase().includes(e)||v.description.toLowerCase().includes(e))}g.value&&(t=t.filter(e=>e.category_id===g.value)),B.value=t}function A(){y.value="",g.value="",L.value=1,b()}const G={"background-color":"#f5f7fa","font-weight":"600",color:"#4e5969","border-bottom":"1px solid #e5e6eb"};function H({row:t,rowIndex:e}){return e%2===0?"table-row-even":"table-row-odd"}function J(t){return{科技:"primary",娱乐:"success",教育:"info",音乐:"warning",电影:"danger"}[t]||"default"}function Q(t){a.value={id:t.id,title:t.title,description:t.description,categoryId:t.category_id},f.value=!0}async function W(){if(!a.value.title.trim()){p.warning("请输入标题");return}if(!a.value.categoryId){p.warning("请选择分类");return}$.value=!0;try{const t=await C.put(`${V}/api/admin/videos/${a.value.id}`,{title:a.value.title,description:a.value.description,categoryId:a.value.categoryId});t.data&&(t.data.code===0||t.data.code===200)?(p.success("保存成功"),f.value=!1,await U()):p.error(t.data.message||"保存失败")}catch{p.error("请求出错")}finally{$.value=!1}}function X(t){q.push({path:`/admin/details/${t.id}`})}function Y(t){I.value=t,w.value=!0}async function Z(){if(I.value)try{const t=await C.delete(`${V}/api/admin/videos/${I.value.id}`);t.data&&(t.data.code===0||t.data.code===200)?(p.success("删除成功"),w.value=!1,await U()):p.error(t.data.message||"删除失败")}catch{p.error("请求出错")}}return(t,e)=>{const v=i("el-icon"),r=i("el-button"),D=i("el-input"),N=i("el-option"),M=i("el-select"),m=i("el-table-column"),ee=i("el-tag"),te=i("el-table"),S=i("el-form-item"),le=i("el-form"),R=i("el-dialog");return c(),_("div",ae,[d("div",de,[e[12]||(e[12]=d("div",{class:"header-content"},[d("h1",null,"视频管理"),d("p",{class:"header-desc"},"管理所有视频内容，支持编辑、删除和查看详情")],-1)),o(r,{type:"primary",onClick:e[0]||(e[0]=l=>t.$router.push("/admin/upload")),class:"upload-btn"},{default:n(()=>[o(v,null,{default:n(()=>[o(k(we))]),_:1}),e[11]||(e[11]=u(" 新增视频 "))]),_:1,__:[11]})]),d("div",se,[d("div",ie,[o(D,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=l=>y.value=l),placeholder:"搜索视频标题","prefix-icon":"Search",class:"search-input",onKeyup:ne(j,["enter"])},null,8,["modelValue"]),o(M,{modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=l=>g.value=l),placeholder:"筛选分类",class:"category-select",onChange:b},{default:n(()=>[o(N,{value:"",label:"全部分类"}),(c(!0),_(K,null,z(h.value,l=>(c(),F(N,{key:l.value,label:l.text,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(r,{type:"default",onClick:A},{default:n(()=>e[13]||(e[13]=[u("重置筛选")])),_:1,__:[13]})]),E.value.length?(c(),F(te,{key:0,data:B.value,style:{width:"100%"},border:"",stripe:"","header-cell-style":G,"row-class-name":H,loading:x.value},{default:n(()=>[o(m,{type:"index",label:"序号",width:"80",align:"center"}),o(m,{label:"缩略图",width:"180",align:"center"},{default:n(({row:l})=>[d("div",ue,[l.cover_url?(c(),_("img",{key:1,src:l.cover_url,class:"img-thumb",alt:"视频封面"},null,8,ce)):(c(),_("video",{key:0,src:l.video_url,class:"video-thumb",controls:"",preload:"metadata"},null,8,re))])]),_:1}),o(m,{prop:"title",label:"标题","min-width":"200"},{default:n(({row:l})=>[d("div",pe,P(l.title),1)]),_:1}),o(m,{prop:"category",label:"分类",width:"100",align:"center"},{default:n(({row:l})=>[o(ee,{type:J(l.category)},{default:n(()=>[u(P(l.category),1)]),_:2},1032,["type"])]),_:1}),o(m,{prop:"description",label:"描述","min-width":"250"},{default:n(({row:l})=>[d("div",ve,P(l.description||"无描述"),1)]),_:1}),o(m,{label:"操作",width:"330",align:"center"},{default:n(({row:l})=>[o(r,{size:"mini",type:"primary",onClick:T=>Q(l),class:"action-btn edit-btn"},{default:n(()=>[o(v,null,{default:n(()=>[o(k(ye))]),_:1}),e[14]||(e[14]=u(" 编辑 "))]),_:2,__:[14]},1032,["onClick"]),o(r,{size:"mini",type:"danger",onClick:T=>Y(l),class:"action-btn delete-btn"},{default:n(()=>[o(v,null,{default:n(()=>[o(k(ge))]),_:1}),e[15]||(e[15]=u(" 删除 "))]),_:2,__:[15]},1032,["onClick"]),o(r,{size:"mini",type:"success",onClick:T=>X(l),class:"action-btn view-btn"},{default:n(()=>[o(v,null,{default:n(()=>[o(k(Ve))]),_:1}),e[16]||(e[16]=u(" 详情 "))]),_:2,__:[16]},1032,["onClick"])]),_:1})]),_:1},8,["data","loading"])):(c(),_("div",me,[e[18]||(e[18]=d("img",{src:"https://img.yzcdn.cn/vant/empty-image-default.png",class:"empty-img"},null,-1)),e[19]||(e[19]=d("div",{class:"empty-text"},[d("h3",null,"暂无视频数据"),d("p",null,'请点击"新增视频"按钮上传内容')],-1)),o(r,{type:"primary",onClick:e[3]||(e[3]=l=>t.$router.push("/admin/upload")),class:"empty-action"},{default:n(()=>e[17]||(e[17]=[u(" 新增视频 ")])),_:1,__:[17]})]))]),o(R,{modelValue:f.value,"onUpdate:modelValue":e[8]||(e[8]=l=>f.value=l),title:"编辑视频",width:"500px"},{footer:n(()=>[o(r,{onClick:e[7]||(e[7]=l=>f.value=!1)},{default:n(()=>e[20]||(e[20]=[u("取消")])),_:1,__:[20]}),o(r,{type:"primary",loading:$.value,onClick:W},{default:n(()=>e[21]||(e[21]=[u("保存")])),_:1,__:[21]},8,["loading"])]),default:n(()=>[o(le,{model:a.value,"label-width":"80px"},{default:n(()=>[o(S,{label:"标题",required:""},{default:n(()=>[o(D,{modelValue:a.value.title,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.title=l)},null,8,["modelValue"])]),_:1}),o(S,{label:"描述"},{default:n(()=>[o(D,{modelValue:a.value.description,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.description=l),type:"textarea",rows:"4"},null,8,["modelValue"])]),_:1}),o(S,{label:"分类",required:""},{default:n(()=>[o(M,{modelValue:a.value.categoryId,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.categoryId=l),placeholder:"请选择分类"},{default:n(()=>[(c(!0),_(K,null,z(h.value,l=>(c(),F(N,{key:l.value,label:l.text,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),o(R,{modelValue:w.value,"onUpdate:modelValue":e[10]||(e[10]=l=>w.value=l),title:"确认删除",width:"400px"},{footer:n(()=>[o(r,{onClick:e[9]||(e[9]=l=>w.value=!1)},{default:n(()=>e[22]||(e[22]=[u("取消")])),_:1,__:[22]}),o(r,{type:"danger",onClick:Z},{default:n(()=>e[23]||(e[23]=[u("确认")])),_:1,__:[23]})]),default:n(()=>[e[24]||(e[24]=d("span",null,"确认要删除该视频吗？此操作不可恢复",-1))]),_:1,__:[24]},8,["modelValue"])])}}},Ee=oe(be,[["__scopeId","data-v-77a1a907"]]);export{Ee as default};
